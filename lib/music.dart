import 'package:flutter/material.dart';import 'package:flutter/rendering.dart';import 'package:music/constants/constants.dart';import 'package:music/player.dart';import 'package:music/widgets/container.dart';import 'package:music/widgets/thumbnail.dart';import 'package:on_audio_query/on_audio_query.dart';import 'package:permission_handler/permission_handler.dart';class Music extends StatefulWidget {  const Music({Key? key}) : super(key: key);  @override  State<Music> createState() => _MusicState();}class _MusicState extends State<Music> {  final _audioQuery = OnAudioQuery();  @override void initState(){    super.initState();    requestPermission();    scrollViewController = ScrollController();    scrollViewController.addListener(() {      if (scrollViewController.position.userScrollDirection == ScrollDirection.reverse) {        if (!isScrollingDown) {          setState(() {            isScrollingDown = true;            showAppbar = false;          });        }      }      if (scrollViewController.position.userScrollDirection == ScrollDirection.forward) {        if (isScrollingDown) {          setState(() {            isScrollingDown = false;            showAppbar = true;          });        }      }    });  }  @override  void dispose() {    scrollViewController.dispose();    scrollViewController.removeListener(() {});    super.dispose();  }  @override  Widget build(BuildContext context) {    return Scaffold(      extendBodyBehindAppBar: true,      extendBody: true,      appBar: AppBar(        elevation: 0.0,        backgroundColor: Colors.transparent,        title:    AnimatedContainer(        height: showAppbar ? 40.0 : 0.0,        duration: const Duration(milliseconds: 300),        child:  const Center(child: const Text('My Music'))      )),      body: Stack(children: [         ColorContainer(             const Color(0xff302b63),const Color(0xff302b63),             const Color(0xff08061d),const Color(0xff08061d)),        Center(          child: FutureBuilder<List<SongModel>>(            future: _audioQuery.querySongs(              sortType: SongSortType.DATE_ADDED,              orderType: OrderType.DESC_OR_GREATER,              uriType: UriType.EXTERNAL,              ignoreCase: true, ),            builder: (context,Data){              if(Data.data==null){                return const Center(child: CircularProgressIndicator(),);              }              if(Data.data?.isEmpty==null){                return const Center(child: Text("No Song Found"),);              }              else{                return ListView.builder(                    controller: scrollViewController,                    itemCount: Data.data!.length,                    itemBuilder: (context,index){                      return Padding(                        padding: const EdgeInsets.only(top: 8.0),                        child: ListTile(                          onTap: (){                            Navigator.push(context,                                MaterialPageRoute(builder: (context)=>Player(Data.data![index]))); },                          title: Text(                            Data.data![index].title,                            maxLines: 1,                            style: const TextStyle(color: Colors.white,fontSize: 14),),                          subtitle:  Text(Data.data![index].album.toString(),style: TextStyle(color: Colors.white.withOpacity(0.8),fontSize: 12),),                          trailing: Column(                            mainAxisAlignment: MainAxisAlignment.spaceEvenly,                            crossAxisAlignment: CrossAxisAlignment.center,                            children: [                            Image.asset("assets/images/play.png",height: 25,width: 25,),                            Text("${(Data.data![index].duration!*0.00001).toStringAsFixed(2)}"),                          ],),                          leading:  ThumbNail(Data.data![index].id,45,5,2),                          textColor: Colors.grey,                        ),                      );                    });              }            },          ),        )      ],)    );  }  void requestPermission() async{    var status = await Permission.storage.status;    if (status.isDenied) {      Permission.storage.request();    }    if (await Permission.location.isRestricted) {      Permission.storage.request();    }  }}